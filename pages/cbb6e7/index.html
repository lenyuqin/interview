<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>集群 | 面试资料总结</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/maomi.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="把面试笔记浓缩成简短的几句话">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#67C23A">
    <link rel="preload" href="/assets/css/0.styles.68120d81.css" as="style"><link rel="preload" href="/assets/js/app.18938b05.js" as="script"><link rel="preload" href="/assets/js/2.29b99567.js" as="script"><link rel="preload" href="/assets/js/10.030962e0.js" as="script"><link rel="prefetch" href="/assets/js/11.41e3edd9.js"><link rel="prefetch" href="/assets/js/12.7fc447d2.js"><link rel="prefetch" href="/assets/js/13.805a5964.js"><link rel="prefetch" href="/assets/js/14.8bcf9be0.js"><link rel="prefetch" href="/assets/js/15.cfc035b8.js"><link rel="prefetch" href="/assets/js/16.bb562fdd.js"><link rel="prefetch" href="/assets/js/17.6ab60b20.js"><link rel="prefetch" href="/assets/js/18.185330be.js"><link rel="prefetch" href="/assets/js/19.8b59a073.js"><link rel="prefetch" href="/assets/js/20.16d0eeda.js"><link rel="prefetch" href="/assets/js/21.319a83e2.js"><link rel="prefetch" href="/assets/js/22.5015a709.js"><link rel="prefetch" href="/assets/js/23.cc4b1f8f.js"><link rel="prefetch" href="/assets/js/24.93ff5fd4.js"><link rel="prefetch" href="/assets/js/25.2999ecb8.js"><link rel="prefetch" href="/assets/js/26.3154e9aa.js"><link rel="prefetch" href="/assets/js/27.c753f0d6.js"><link rel="prefetch" href="/assets/js/28.3f7fb1b9.js"><link rel="prefetch" href="/assets/js/29.d8977776.js"><link rel="prefetch" href="/assets/js/3.bba36e0a.js"><link rel="prefetch" href="/assets/js/30.89a95b06.js"><link rel="prefetch" href="/assets/js/31.ff749ece.js"><link rel="prefetch" href="/assets/js/32.80ce573d.js"><link rel="prefetch" href="/assets/js/33.22fc7d1d.js"><link rel="prefetch" href="/assets/js/34.e5a5fdbb.js"><link rel="prefetch" href="/assets/js/35.2c53e808.js"><link rel="prefetch" href="/assets/js/36.d087b7d9.js"><link rel="prefetch" href="/assets/js/37.f348e662.js"><link rel="prefetch" href="/assets/js/38.25fda87c.js"><link rel="prefetch" href="/assets/js/39.2f6c9b87.js"><link rel="prefetch" href="/assets/js/4.1989b088.js"><link rel="prefetch" href="/assets/js/40.64778c30.js"><link rel="prefetch" href="/assets/js/41.256f9d17.js"><link rel="prefetch" href="/assets/js/42.d8479b47.js"><link rel="prefetch" href="/assets/js/43.246e5c39.js"><link rel="prefetch" href="/assets/js/44.955cedef.js"><link rel="prefetch" href="/assets/js/45.c3c97c7e.js"><link rel="prefetch" href="/assets/js/46.a6d58f23.js"><link rel="prefetch" href="/assets/js/47.fca3e566.js"><link rel="prefetch" href="/assets/js/48.2ee2c66c.js"><link rel="prefetch" href="/assets/js/49.a8810917.js"><link rel="prefetch" href="/assets/js/5.44d22732.js"><link rel="prefetch" href="/assets/js/50.8f1f876f.js"><link rel="prefetch" href="/assets/js/51.469de683.js"><link rel="prefetch" href="/assets/js/52.91a37bbb.js"><link rel="prefetch" href="/assets/js/53.465bb8a2.js"><link rel="prefetch" href="/assets/js/54.d51925f6.js"><link rel="prefetch" href="/assets/js/55.174bf8d1.js"><link rel="prefetch" href="/assets/js/56.4f1da804.js"><link rel="prefetch" href="/assets/js/57.ad813cad.js"><link rel="prefetch" href="/assets/js/58.0136c982.js"><link rel="prefetch" href="/assets/js/59.85dd57d2.js"><link rel="prefetch" href="/assets/js/6.d0290230.js"><link rel="prefetch" href="/assets/js/60.9edb50ab.js"><link rel="prefetch" href="/assets/js/61.3890f868.js"><link rel="prefetch" href="/assets/js/62.57d7756b.js"><link rel="prefetch" href="/assets/js/63.b73c33d4.js"><link rel="prefetch" href="/assets/js/64.5b4671f6.js"><link rel="prefetch" href="/assets/js/65.9eccf210.js"><link rel="prefetch" href="/assets/js/66.891efde8.js"><link rel="prefetch" href="/assets/js/67.cffd78a3.js"><link rel="prefetch" href="/assets/js/68.8b5d3ac6.js"><link rel="prefetch" href="/assets/js/69.a3bcd7df.js"><link rel="prefetch" href="/assets/js/7.22c90848.js"><link rel="prefetch" href="/assets/js/70.903488e5.js"><link rel="prefetch" href="/assets/js/71.c70cc94e.js"><link rel="prefetch" href="/assets/js/72.b06eac24.js"><link rel="prefetch" href="/assets/js/73.cf70ea1f.js"><link rel="prefetch" href="/assets/js/74.0b63b5a8.js"><link rel="prefetch" href="/assets/js/75.3fbe0d7c.js"><link rel="prefetch" href="/assets/js/76.81c66ebf.js"><link rel="prefetch" href="/assets/js/77.9191d21e.js"><link rel="prefetch" href="/assets/js/78.a7244e77.js"><link rel="prefetch" href="/assets/js/79.5f908c7c.js"><link rel="prefetch" href="/assets/js/8.7f81bf0e.js"><link rel="prefetch" href="/assets/js/80.b53cf686.js"><link rel="prefetch" href="/assets/js/81.5a52f022.js"><link rel="prefetch" href="/assets/js/82.c14926fd.js"><link rel="prefetch" href="/assets/js/83.b38e19a8.js"><link rel="prefetch" href="/assets/js/84.30ab6d8f.js"><link rel="prefetch" href="/assets/js/85.399da45a.js"><link rel="prefetch" href="/assets/js/86.660a58bc.js"><link rel="prefetch" href="/assets/js/87.4639f01b.js"><link rel="prefetch" href="/assets/js/9.473e5eed.js">
    <link rel="stylesheet" href="/assets/css/0.styles.68120d81.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/maomi.png" alt="面试资料总结" class="logo"> <span class="site-name can-hide">面试资料总结</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7477f8/" class="nav-link">基础</a></li><li class="dropdown-item"><!----> <a href="/pages/5cc2fd/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/60ebfd/" class="nav-link">JUC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/database/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2392af/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/c0fbb2/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/d451cf/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学科" class="dropdown-title"><a href="/base/" class="link-title">学科</a> <span class="title" style="display:none;">学科</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/82af64/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/0a1bf2/" class="nav-link">计算机网咯</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frame/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1dc564/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/72d04f/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/eeb60a/" class="nav-link">SpringSecurity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法|数据结构" class="dropdown-title"><a href="/algorithm/" class="link-title">算法|数据结构</a> <span class="title" style="display:none;">算法|数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0a676b/" class="nav-link">常见算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><a href="/interview/" class="link-title">面经</a> <span class="title" style="display:none;">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/afb239/" class="nav-link">3月</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/cloud/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/64b78a/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/pages/dd238f/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/4a1bcc/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/pages/198223/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/d451cf/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/pages/58a56d/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/abc736/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/pages/046245/" class="nav-link">ElectSearch</a></li></ul></div></div><div class="nav-item"><a href="https://www.yd-mobile.cn/pack/download?versionId=2802&amp;packName=com.site.lenyuqin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  APP下载
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/lenyuqin/interview" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><a href="/java/" class="link-title">Java</a> <span class="title" style="display:none;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7477f8/" class="nav-link">基础</a></li><li class="dropdown-item"><!----> <a href="/pages/5cc2fd/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/pages/60ebfd/" class="nav-link">JUC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="MySQL" class="dropdown-title"><a href="/database/" class="link-title">MySQL</a> <span class="title" style="display:none;">MySQL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/2392af/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/c0fbb2/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/d451cf/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学科" class="dropdown-title"><a href="/base/" class="link-title">学科</a> <span class="title" style="display:none;">学科</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/82af64/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/0a1bf2/" class="nav-link">计算机网咯</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/frame/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1dc564/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/pages/72d04f/" class="nav-link">Mybatis</a></li><li class="dropdown-item"><!----> <a href="/pages/eeb60a/" class="nav-link">SpringSecurity</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法|数据结构" class="dropdown-title"><a href="/algorithm/" class="link-title">算法|数据结构</a> <span class="title" style="display:none;">算法|数据结构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/0a676b/" class="nav-link">常见算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><a href="/interview/" class="link-title">面经</a> <span class="title" style="display:none;">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/afb239/" class="nav-link">3月</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式" class="dropdown-title"><a href="/cloud/" class="link-title">分布式</a> <span class="title" style="display:none;">分布式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/64b78a/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/pages/dd238f/" class="nav-link">Nginx</a></li><li class="dropdown-item"><!----> <a href="/pages/4a1bcc/" class="nav-link">SpringCloud</a></li><li class="dropdown-item"><!----> <a href="/pages/198223/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/pages/d451cf/" class="nav-link">MongoDB</a></li><li class="dropdown-item"><!----> <a href="/pages/58a56d/" class="nav-link">Zookeeper</a></li><li class="dropdown-item"><!----> <a href="/pages/abc736/" class="nav-link">Dubbo</a></li><li class="dropdown-item"><!----> <a href="/pages/046245/" class="nav-link">ElectSearch</a></li></ul></div></div><div class="nav-item"><a href="https://www.yd-mobile.cn/pack/download?versionId=2802&amp;packName=com.site.lenyuqin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  APP下载
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/lenyuqin/interview" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c0fbb2/" class="sidebar-link">Redis总结</a></li><li><a href="/pages/cbb6e7/" aria-current="page" class="active sidebar-link">集群</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#redis有下面四种部署方式" class="sidebar-link">Redis有下面四种部署方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#redis主从复制" class="sidebar-link">redis主从复制</a></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#哨兵模式" class="sidebar-link">哨兵模式</a></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#redis-cluster" class="sidebar-link">Redis Cluster</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#redis限流" class="sidebar-link">Redis限流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#基于redis的setnx、zset" class="sidebar-link">基于Redis的setnx、zset</a></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#漏桶算法" class="sidebar-link">漏桶算法</a></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#令牌桶算法" class="sidebar-link">令牌桶算法</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#分布式锁" class="sidebar-link">分布式锁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#zookeeper实现分布式锁" class="sidebar-link">Zookeeper实现分布式锁</a></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#redis实现分布式锁" class="sidebar-link">Redis实现分布式锁</a></li><li class="sidebar-sub-header"><a href="/pages/cbb6e7/#redisson实现分布式锁" class="sidebar-link">Redisson实现分布式锁</a></li></ul></li></ul></li><li><a href="/pages/56183d/" class="sidebar-link">数据结构</a></li><li><a href="/pages/9cc23d/" class="sidebar-link">线程模型</a></li><li><a href="/pages/daf174/" class="sidebar-link">高并发</a></li><li><a href="/pages/44c025/" class="sidebar-link">布谷鸟过滤器</a></li><li><a href="/pages/209706/" class="sidebar-link">RDB+AOF</a></li><li><a href="/pages/b50626/" class="sidebar-link">过期，淘汰</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><a href="/categories/?category=Database" title="分类" data-v-33863c7e>Database</a></li> <li data-v-33863c7e><a href="/categories/?category=Redis" title="分类" data-v-33863c7e>Redis</a></li> <!----></ul> <div class="info" data-v-33863c7e><div title="作者" class="author iconfont icon-touxiang" data-v-33863c7e><a href="https://github.com/lenyuqin" target="_blank" title="作者" class="beLink" data-v-33863c7e>lenyuqin</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2021-04-10</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          集群
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="redis有下面四种部署方式"><a href="#redis有下面四种部署方式" class="header-anchor">#</a> Redis有下面四种部署方式</h2> <table><thead><tr><th style="text-align:center;">模式</th> <th style="text-align:center;">优点</th> <th style="text-align:center;">缺点</th></tr></thead> <tbody><tr><td style="text-align:center;">单机版</td> <td style="text-align:center;">架构简单，部署方便</td> <td style="text-align:center;">机器故障、容量瓶颈、QPS瓶颈</td></tr> <tr><td style="text-align:center;">主从复制</td> <td style="text-align:center;">高可靠性，读写分离</td> <td style="text-align:center;">故障恢复复杂，主库的写跟存受单机限制</td></tr> <tr><td style="text-align:center;">Sentinel 哨兵</td> <td style="text-align:center;">集群部署简单，HA</td> <td style="text-align:center;">原理繁琐，slave存在资源浪费，不能解决读写分离问题</td></tr> <tr><td style="text-align:center;">Redis Cluster</td> <td style="text-align:center;">数据动态存储solt，可扩展，高可用</td> <td style="text-align:center;">客户端动态感知后端变更，批量操作支持查</td></tr></tbody></table> <h3 id="redis主从复制"><a href="#redis主从复制" class="header-anchor">#</a> redis主从复制</h3> <p>该模式下 具有高可用性且读写分离， 会采用 <code>增量同步</code> 跟 <code>全量同步</code> 两种机制。</p> <p>Redis全量复制一般发生在<strong>Slave初始化阶段</strong>，这时Slave需要将Master上的<strong>所有数据</strong>都复制一份</p> <blockquote><p>1、slave连接master，发送<code>psync</code>命令。</p> <p>2、master接收到<code>psync</code>命名后，开始执行bgsave命令生成RDB文件并使用缓冲区记录此后执行的所有写命令。</p> <p>3、master发送快照文件到slave，并在发送期间继续记录被执行的写命令。4、slave收到快照文件后丢弃所有旧数据，载入收到的快照。</p> <p>5、master快照发送完毕后开始向slave发送缓冲区中的写命令。</p> <p>6、slave完成对快照的载入，开始接收命令请求，并执行来自master缓冲区的写命令。</p></blockquote> <p>增量同步也叫指令同步，。Redis会把指令存放在一个<strong>环形队列</strong>当中，因为内存容量有限，如果备机一直起不来，不可能把所有的内存都去存指令，也就是说，如果备机一直未同步，指令可能会被覆盖掉。</p> <p>Redis增量复制是指Slave初始化后开始正常工作时master发生的写操作同步到slave的过程。增量复制的过程主要是master每执行一个写命令就会向slave发送相同的写命令。</p> <p>1、<code>主从刚刚连接的时候，进行全量同步；全同步结束后，进行增量同步</code>。当然，如果有需要，slave 在任何时候都可以发起全量同步。redis 策略是，无论如何，首先会尝试进行增量同步，如不成功，要求从机进行全量同步。2、slave在同步master数据时候如果slave丢失连接不用怕，slave在重新连接之后<code>丢失重补</code>。</p> <p>3、一般通过主从来实现读写分离，但是如果master挂掉后如何保证Redis的 HA呢？引入<code>Sentinel</code>进行master的选</p> <h3 id="哨兵模式"><a href="#哨兵模式" class="header-anchor">#</a> 哨兵模式</h3> <p><img src="https://img.xiaoyou66.com/2021/03/27/6ef3c91c9009f.png" alt="image.png"></p> <p>Redis-sentinel 本身是一个<strong>独立</strong>运行的进程，一般sentinel集群 节点数至少三个且奇数个，它能监控多个master-slave集群，sentinel节点发现master宕机后能进行自动切换。Sentinel可以监视任意多个主服务器以及主服务器属下的从服务器，并在被监视的主服务器下线时，<strong>自动执行故障转移操作</strong>。这里需注意<code>sentinel</code>也有<code>single-point-of-failure</code>问题。大致罗列下哨兵用途：</p> <blockquote><p>集群监控：循环监控master跟slave节点。</p> <p>消息通知：当它发现有redis实例有故障的话，就会发送消息给管理员</p> <p>故障转移：这里分为主观下线(单独一个哨兵发现master故障了)。客观下线(多个哨兵进行抉择发现达到quorum数时候开始进行切换)。</p> <p>配置中心：如果发生了故障转移，它会通知将master的新地址写在配置中心告诉客户端。</p></blockquote> <h4 id="存在的问题"><a href="#存在的问题" class="header-anchor">#</a> 存在的问题</h4> <p>就是会有脑裂的情况，就是当一台主节点的机子因为某些原因无法进行连接了，哨兵以为它挂了，就重新选举出一台新的机子作为主节点，但后续之前那台机子又恢复过来了，这样整个集群就有了两个主节点了，就好像大脑分裂了一样。</p> <p>解决方案也很简单：就是将之前的主节点降级为从节点就行了</p> <h3 id="redis-cluster"><a href="#redis-cluster" class="header-anchor">#</a> Redis Cluster</h3> <p>RedisCluster是Redis的分布式解决方案，在3.0版本后推出的方案，有效地解决了Redis分布式的需求。说白了就是把数据分布在不同的节点上，采用去中心化的思想</p> <p><img src="https://img.xiaoyou66.com/2021/03/27/884ca253e81e8.png" alt="image.png"></p> <p>分区规则如下</p> <p><img src="https://img.xiaoyou66.com/2021/03/27/fa34af8385722.png" alt="image.png"></p> <p>有下面这几个分区规则</p> <ol><li><code>节点取余</code>：hash(key) % N</li> <li><code>一致性哈希</code>：一致性哈希环</li> <li><code>虚拟槽哈希</code>：CRC16[key] &amp; 16383</li></ol> <p><strong>总结</strong></p> <ol><li>RedisCluster采用了<code>虚拟槽分区</code>方式</li> <li>采用去<strong>中心化</strong>的思想，它使用<strong>虚拟槽solt分区</strong>覆盖到所有节点上，取数据一样的流程，节点之间使用轻量协议通信<strong>Gossip</strong>来减少带宽占用所以性能很高</li> <li>自动实现<strong>负载均衡与高可用</strong>，自动实现<strong>failover</strong>并且支持<strong>动态扩展</strong>，官方已经玩到可以1000个节点 实现的复杂度低。</li> <li>每个Master也需要配置主从，并且内部也是采用<strong>哨兵模式</strong>，如果有半数节点发现某个异常节点会共同决定更改异常节点的状态。</li> <li>如果集群中的master没有slave节点，则master挂掉后整个集群就会进入<strong>fail</strong>状态，因为集群的slot映射不完整。<strong>如果集群超过半数以上的master挂掉，集群都会进入fail状态</strong>。</li> <li>官方推荐 <strong>集群部署至少要3台以上的master节点</strong>。</li></ol> <h2 id="redis限流"><a href="#redis限流" class="header-anchor">#</a> Redis限流</h2> <p>在开发高并发系统时，有三把利器用来保护系统：<code>缓存</code>、<code>降级</code>和<code>限流</code>。目前主要有下面这几种限流的算法</p> <h3 id="基于redis的setnx、zset"><a href="#基于redis的setnx、zset" class="header-anchor">#</a> 基于Redis的setnx、zset</h3> <p><strong>setnx</strong></p> <p>比如我们需要在10秒内限定20个请求，那么我们在setnx的时候可以设置过期时间10，当请求的setnx数量达到20时候即达到了限流效果。</p> <p><strong>缺点</strong>：比如当统计1-10秒的时候，无法统计2-11秒之内，如果需要统计N秒内的M个请求，那么我们的Redis中<strong>需要保持N个key等等问题</strong>。</p> <p><strong>zset</strong></p> <p>其实限流涉及的最主要的就是滑动窗口，上面也提到1-10怎么变成2-11。其实也就是起始值和末端值都各+1即可。我们可以将请求打造成一个<strong>zset数组</strong>，当每一次请求进来的时候，value保持唯一，可以用UUID生成，而score可以用当前时间戳表示，因为score我们可以用来计算当前时间戳之内有多少的请求数量。而zset数据结构也提供了<strong>range</strong>方法让我们可以很轻易的获取到2个时间戳内有多少请求，</p> <p><strong>缺点</strong>：就是zset的数据结构会越来越大。</p> <h3 id="漏桶算法"><a href="#漏桶算法" class="header-anchor">#</a> 漏桶算法</h3> <p>把水比作是请求，漏桶比作是系统处理能力极限，水先进入到漏桶里，漏桶里的水<strong>按一定速率流出</strong>，当流出的速率小于流入的速率时，由于漏桶容量有限，后续进入的水直接溢出（拒绝请求），以此实现限流。</p> <p><img src="https://img.xiaoyou66.com/2021/03/27/ce0cbe2c25ba9.png" alt="image.png"></p> <h3 id="令牌桶算法"><a href="#令牌桶算法" class="header-anchor">#</a> 令牌桶算法</h3> <p>令牌桶算法的原理：可以理解成医院的挂号看病，只有拿到号以后才可以进行诊病。</p> <p><img src="https://img.xiaoyou66.com/2021/03/27/5224f71f9f234.png" alt="image.png"></p> <p><strong>一些细节</strong></p> <ol><li>所有的请求在处理之前都需要<strong>拿到一个可用的令牌才会被处理</strong>。</li> <li>根据限流大小，设置按照一定的速率往桶里添加令牌。</li> <li>设置桶最大可容纳值，当桶满时新添加的令牌就被丢弃或者拒绝。</li> <li>请求达到后首先要获取令牌桶中的令牌，拿着令牌才可以进行其他的业务逻辑，处理完业务逻辑之后，将令牌直接删除。</li> <li>令牌桶有最低限额，当桶中的令牌达到最低限额的时候，请求处理完之后将不会删除令牌，以此保证足够的限流</li></ol> <h2 id="分布式锁"><a href="#分布式锁" class="header-anchor">#</a> 分布式锁</h2> <p>在日常情况下在进程或线程中我们可以使用 synchronized 、Lock 实现并发编程，但如何在分布式集群下使用呢？可以使用 <strong>Redisson</strong> ， <strong>Zookeeper</strong> ，<strong>Redis本身</strong></p> <h3 id="zookeeper实现分布式锁"><a href="#zookeeper实现分布式锁" class="header-anchor">#</a> Zookeeper实现分布式锁</h3> <blockquote><p>1、持久节点：客户端断开连接zk不删除persistent类型节点</p> <p>2、临时节点：客户端断开连接zk删除ephemeral类型节点</p> <p>3、顺序节点：节点后面会自动生成类似0000001的数字表示顺序</p> <p>4、节点变化的通知：客户端注册了监听节点变化的时候，会<strong>调用回调方法</strong></p></blockquote> <p><img src="https://img.xiaoyou66.com/2021/03/27/d85322d697d6d.png" alt="image.png"></p> <p><strong>缺点</strong></p> <p>频繁的创建删除节点，加上注册watch事件，对于zookeeper集群的压力比较大，性能也比不上Redis实现的分布式锁。</p> <h3 id="redis实现分布式锁"><a href="#redis实现分布式锁" class="header-anchor">#</a> Redis实现分布式锁</h3> <p>本身原理也比较简单，Redis 自身就是一个单线程处理器，具备互斥的特性，通过setNX，exist等命令就可以完成简单的分布式锁，处理好超时释放锁的逻辑即可。</p> <ul><li><p><strong>SETNX</strong></p> <p>SETNX 是SET if Not eXists的简写，日常指令是<code>SETNX key value</code>，如果 key 不存在则set成功返回 1，如果这个key已经存在了返回0。</p></li> <li><p><strong>SETEX</strong></p> <p>SETEX key seconds value 表达的意思是 将值 value 关联到 key ，并将 key 的生存时间设为多少秒。如果 key 已经存在，setex命令将覆写旧值。并且 setex是一个<code>原子性</code>(atomic)操作。</p></li> <li><p><strong>加锁</strong></p> <p>一般就是用一个标识唯一性的字符串比如UUID 配合 SETNX 实现加锁。</p></li> <li><p><strong>解锁</strong></p> <p>这里用到了LUA脚本，LUA可以保证是<strong>原子性</strong>的，思路就是判断一下Key和入参是否相等，是的话就删除，返回成功1，0就是失败。</p></li></ul> <p><strong>缺点</strong></p> <p>这个锁是<strong>无法重入的</strong>，且自己实心的话各种边边角角都要考虑到，所以了解个大致思路流程即可，<strong>工程化还是用开源工具包就行</strong>。</p> <p><strong>存在的问题</strong></p> <p>普通利用Redis实现分布式锁的时候，我们可能会为某个锁指定某个key，当线程获取锁并执行完业务逻辑代码的时候，将该锁对应的key删除掉来释放锁。lock-&gt;set(key)，成功-&gt;执行业务，业务执行完毕-&gt;unlock-&gt;del(key)。</p> <p><strong>第一个问题</strong>，因为我们的业务不知道要执行多久才能结束，所以这个key我们一般不会设置过期时间。这样如果在执行业务的过程中，业务机器宕机，unlock操作不会执行，所以这个锁不会被释放，其他机器拿不到锁，从而形成了死锁。</p> <p><strong>第二个问题</strong>，如果Redis宕机，三种情况：</p> <p>①Redis是单点模式</p> <p>②Redis是集群模式，master在获取到一把锁之后（写操作成功后），在没来得及把该锁同步到slave之前就宕掉，这个时候slave没有锁，这把锁失效了……</p> <p>③Redis是集群模式，而整个集群都宕机，那么就没救了……</p> <p><a href="https://blog.csdn.net/xxcupid/article/details/88120581" target="_blank" rel="noopener noreferrer">Redisson（1）分布式锁——如何解决死锁问题_xxcupid的博客-CSDN博客_redisson分布式锁缺陷解决(opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="redisson实现分布式锁"><a href="#redisson实现分布式锁" class="header-anchor">#</a> Redisson实现分布式锁</h3> <p><strong>Redisson</strong> 是在Redis基础上的一个服务，采用了基于NIO的Netty框架，不仅能作为Redis底层驱动<strong>客户端</strong>，还能将原生的RedisHash，List，Set，String，Geo，HyperLogLog等数据结构封装为Java里大家最熟悉的映射（Map），列表（List），集（Set），通用对象桶（Object Bucket），地理空间对象桶（Geospatial Bucket），基数估计算法（HyperLogLog）等结构。</p> <p><img src="https://img.xiaoyou66.com/2021/03/27/58a24fd86143a.png" alt="image.png"></p> <p>加锁解锁的流程如下</p> <p><img src="https://img.xiaoyou66.com/2021/03/27/824f29530bd2b.png" alt="image.png"></p> <p><a href="https://www.cnblogs.com/chengxy-nds/p/12750502.html" target="_blank" rel="noopener noreferrer">redis 分布式锁的 5个坑，真是又大又深 - 程序员内点事 - 博客园 (cnblogs.com)(opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>这里应该会问你Redisson解决了啥问题</p> <ol><li>可以实现可重入加锁机制</li> <li>在一个分布式环境下，假如一个线程获得锁后，突然服务器宕机了，那么这个时候在一定时间后这个锁会自动释放，你也可以设置锁的有效时间(不设置默认30秒），这样的目的主要是防止死锁的发生。</li></ol></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/lenyuqin/interview/edit/master/docs/01.Database/02.Redis/02.集群.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/04/14, 15:03:34</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/c0fbb2/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Redis总结</div></a> <a href="/pages/56183d/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">数据结构</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/c0fbb2/" class="prev">Redis总结</a></span> <span class="next"><a href="/pages/56183d/">数据结构</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2021
    <span>lenyuqin</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.18938b05.js" defer></script><script src="/assets/js/2.29b99567.js" defer></script><script src="/assets/js/10.030962e0.js" defer></script>
  </body>
</html>