---
title: 过期，淘汰
date: 2021-04-14 11:11:46
permalink: /pages/b50626/
categories:
  - Redis
tags:
  - 
---
## Redis三种过期策略

### 定时过期

每个设置过期时间的key都需要创建一个定时器，到过期时间就会立即对key进行清除。该策略可以立即清除过期的数据，对内存很友好；但是**会占用大量的CPU资源去处理过期的数据**，从而影响缓存的响应时间和吞吐量。

### 惰性过期

只有当访问一个key时，才会判断该key是否已过期，过期则清除。该策略可以最大化地节省CPU资源，却**对内存非常不友好**。极端情况可能出现大量的过期key没有再次被访问，从而不会被清除，占用大量内存。

### 定期过期

每隔一定的时间，会扫描一定数量的数据库的expires字典中一定数量的key，并清除其中已过期的key。该策略是前两者的一个折中方案。通过调整定时扫描的时间间隔和每次扫描的限定耗时，可以在不同情况下使得CPU和内存资源**达到最优**的平衡效果。

expires字典会保存所有设置了过期时间的key的过期时间数据，其中 key 是指向键空间中的某个键的指针，value是该键的毫秒精度的UNIX时间戳表示的过期时间。键空间是指该Redis集群中保存的所有键。

### 默认策略

Redis采用的过期策略：`惰性删除` + `定期删除`。memcached采用的过期策略：`惰性删除`。

## Redis 6种内存淘汰策略

内存淘汰策略是指在Redis的用于缓存的**内存不足时，怎么处理需要新写入且需要申请额外空间的数据**

> 过期策略指的是如何让key过期（此时内存可能有很多），而淘汰就是当我们内存不够时淘汰哪些数据（此时key可能并没有过期）

1. volatile-lru（**常考**）：从已设置过期时间的数据集（server.db[i].expires）中挑选**最近最少使用**的数据淘汰
2. volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选**将要过期**的数据淘汰
3. volatile-random：从已设置过期时间的数据集（server.db[i].expires）中**任意选择**数据淘汰
4. allkeys-lru：从数据集（server.db[i].dict）中挑选**最近最少使用**的数据淘汰
5. allkeys-random：从数据集（server.db[i].dict）中**任意选择数**据淘汰 
6. no-enviction（驱逐）：禁止驱逐数据，**不删除**的意思。

