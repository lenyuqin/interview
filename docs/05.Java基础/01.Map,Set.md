---
title: Map,Set
date: 2021-04-10 11:09:53
permalink: /pages/f329dd/
categories:
  - JavaåŸºç¡€
tags:
  - 
---
## Hashmapï¼ŒConcurrentHashMapï¼ŒConcurrentHashSetï¼ŒHashSet

å› ä¸ºè¿™äº›æˆ‘ä¸ªäººéƒ½æœ‰äº†è§£è¿‡ï¼Œç›®å‰å°±è®°å½•ä¸€äº›å¸¸è§çš„é—®é¢˜é…åˆå›¾ç‰‡æ–¹ä¾¿è®°å¿†ï¼Œç”¨äºå¤‡å¿˜ğŸ‘€ã€‚

## Hashmap

æ•°æ®ç»“æ„å›¾

![img](https://img-blog.csdnimg.cn/img_convert/946c3ddd77b0a44c8c441b7ba8b06a27.png)

![0-00000031](https://img-blog.csdnimg.cn/img_convert/45323e4415df307ef3823d783e1077a6.png)



### å¸¸è§é—®é¢˜ï¼š

1. Java1.8å’Œ1.7ï¼ŒHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåšäº†ä»€ä¹ˆä¼˜åŒ–
2. HashMapæ‰©å®¹è¿‡ç¨‹ï¼Œä¸ºä»€ä¹ˆè¦æ‰©å®¹2çš„å€æ•°ï¼Ÿä¸ºä»€ä¹ˆé»˜è®¤å®¹é‡æ˜¯16ï¼Ÿ
3. è®²è®²HashMap  getå’Œput
4. hashmap ä¸ºä»€ä¹ˆå¯ä»¥æ’å…¥ç©ºå€¼
5.  Hashmap ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨
6. hashmapåˆ¤å®šé‡å¤æ˜¯==è¿˜æ˜¯equals

#### 1ï¼ŒJava1.8å’Œ1.7ï¼ŒHashMapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œåšäº†ä»€ä¹ˆä¼˜åŒ–

ç»“æ„ä¼˜åŒ–ï¼šç”±æ•°ç»„+é“¾è¡¨è½¬åŒ–ä¸ºæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘

æ’å…¥ä¼˜åŒ–ï¼šç”±å¤´æ’æ³•è½¬åŒ–ä¸ºå°¾æ’æ³•

æ‰©å®¹ä¼˜åŒ–ï¼šjava8  ä¸­å¯¹ hashmap æ‰©å®¹ä¸æ˜¯é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ åœ¨æ•°ç»„çš„ä½ç½®ï¼Œè€Œæ˜¯æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ 2 æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥ 2  å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨ 2 æ¬¡å¹‚çš„ä½ç½®ï¼Œåœ¨æ‰©å…… HashMap çš„æ—¶å€™ï¼Œä¸éœ€è¦åƒ JDK1.7 çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®— hashï¼Œ åªéœ€è¦çœ‹çœ‹åŸæ¥çš„ hash å€¼æ–°å¢çš„é‚£ä¸ª bit æ˜¯ 1 è¿˜æ˜¯ 0 å°±å¥½äº†ï¼Œæ˜¯ 0 çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯ 1 çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€

#### 2ï¼ŒHashMapæ‰©å®¹è¿‡ç¨‹ï¼Œä¸ºä»€ä¹ˆè¦æ‰©å®¹2çš„å€æ•°ï¼Ÿä¸ºä»€ä¹ˆé»˜è®¤å®¹é‡æ˜¯16ï¼Ÿ

æ‰©å®¹è¿‡ç¨‹ï¼šåˆ†ä¸ºä¸¤æ­¥

- æ‰©å®¹ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Entryç©ºæ•°ç»„ï¼Œé•¿åº¦æ˜¯åŸæ•°ç»„çš„2å€ã€‚
- ReHashï¼šéå†åŸEntryæ•°ç»„ï¼ŒæŠŠæ‰€æœ‰çš„Entryé‡æ–°Hashåˆ°æ–°æ•°ç»„ã€‚

è¿™æ ·æ˜¯ä¸ºäº†ä½è¿ç®—çš„æ–¹ä¾¿ï¼Œ**ä½ä¸è¿ç®—æ¯”ç®—æ•°è®¡ç®—çš„æ•ˆç‡é«˜äº†å¾ˆå¤š**ï¼Œä¹‹æ‰€ä»¥é€‰æ‹©16ï¼Œæ˜¯ä¸ºäº†æœåŠ¡å°†Keyæ˜ å°„åˆ°indexçš„ç®—æ³•ã€‚

æ˜¯çš„æˆ‘ä»¬é€šè¿‡Keyçš„HashCodeå€¼å»åšä½è¿ç®—

é€‰åå…­æ˜¯å·¥ä¸šæ—¶é—´çš„æ•ˆæœï¼šä¸ºäº†å®ç°å‡åŒ€åˆ†å¸ƒ

#### 3ï¼Œè®²è®²HashMap  getå’Œput

**put**

å¾€mapæ’å…¥å…ƒç´ çš„æ—¶å€™é¦–å…ˆé€šè¿‡å¯¹key hashç„¶åä¸æ•°ç»„é•¿åº¦-1è¿›è¡Œä¸è¿ç®—((n-1)&hash)ï¼Œéƒ½æ˜¯2çš„æ¬¡å¹‚æ‰€ä»¥ç­‰åŒäºå–æ¨¡ï¼Œä½†æ˜¯ä½è¿ç®—çš„æ•ˆç‡æ›´é«˜ã€‚æ‰¾åˆ°æ•°ç»„ä¸­çš„ä½ç½®ä¹‹åï¼Œå¦‚æœæ•°ç»„ä¸­æ²¡æœ‰å…ƒç´ ç›´æ¥å­˜å…¥ï¼Œåä¹‹åˆ™åˆ¤æ–­keyæ˜¯å¦ç›¸åŒï¼Œkeyç›¸åŒå°±è¦†ç›–ï¼Œå¦åˆ™å°±ä¼šæ’å…¥åˆ°é“¾è¡¨çš„å°¾éƒ¨ï¼Œå¦‚æœé“¾è¡¨çš„é•¿åº¦è¶…è¿‡8ï¼Œåˆ™ä¼šè½¬æ¢æˆçº¢é»‘æ ‘ï¼Œæœ€ååˆ¤æ–­æ•°ç»„é•¿åº¦æ˜¯å¦è¶…è¿‡é»˜è®¤çš„é•¿åº¦*è´Ÿè½½å› å­ä¹Ÿå°±æ˜¯12ï¼Œè¶…è¿‡åˆ™è¿›è¡Œæ‰©å®¹ã€‚

![img](https://img.xiaoyou66.com/2021/03/30/c83536ef87158.jpg)

#### 4ï¼Œhashmap ä¸ºä»€ä¹ˆå¯ä»¥æ’å…¥ç©ºå€¼

HashMap ä¸­æ·»åŠ  key ==null çš„ Entry æ—¶ä¼šè°ƒç”¨ putForNullKey æ–¹æ³•ç›´æ¥å»éå†table[0]Entry é“¾è¡¨ï¼Œå¯»æ‰¾ e.key ==null çš„ Entry æˆ–è€…æ²¡æœ‰æ‰¾åˆ°éå†ç»“æŸ

å¦‚æœæ‰¾åˆ°äº† e.key==nullï¼Œå°±ä¿å­˜ null å€¼å¯¹åº”çš„åŸå€¼ oldValueï¼Œç„¶åè¦†ç›–åŸå€¼ï¼Œå¹¶è¿”å›oldValue
å¦‚æœåœ¨ table[0]Entry é“¾è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°å°±è°ƒç”¨addEntry æ–¹æ³•æ·»åŠ ä¸€ä¸ª key ä¸º null çš„ Entry

#### 5ï¼ŒHashmap ä¸ºä»€ä¹ˆçº¿ç¨‹ä¸å®‰å…¨

é¦–å…ˆHashMapæ˜¯**çº¿ç¨‹ä¸å®‰å…¨**çš„ï¼Œå…¶ä¸»è¦ä½“ç°ï¼š

1.åœ¨jdk1.7ä¸­ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæ‰©å®¹æ—¶ä¼šé€ æˆç¯å½¢é“¾æˆ–æ•°æ®ä¸¢å¤±ã€‚

2.åœ¨jdk1.8ä¸­ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œä¼šå‘ç”Ÿæ•°æ®è¦†ç›–çš„æƒ…å†µã€‚

#### 6ï¼Œhashmapåˆ¤å®šé‡å¤æ˜¯==è¿˜æ˜¯equals

å½“ä½ æŠŠå¯¹è±¡åŠ å…¥`HashSet`æ—¶ï¼ŒHashSetä¼šå…ˆè®¡ç®—å¯¹è±¡çš„`hashcode`å€¼æ¥åˆ¤æ–­å¯¹è±¡åŠ å…¥çš„ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿä¼šä¸å…¶ä»–åŠ å…¥çš„å¯¹è±¡çš„hashcodeå€¼ä½œæ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰ç›¸ç¬¦çš„hashcodeï¼ŒHashSetä¼šå‡è®¾å¯¹è±¡æ²¡æœ‰é‡å¤å‡ºç°ã€‚ä½†æ˜¯å¦‚æœå‘ç°æœ‰ç›¸åŒhashcodeå€¼çš„å¯¹è±¡ï¼Œè¿™æ—¶ä¼šè°ƒç”¨`equalsï¼ˆï¼‰`æ–¹æ³•æ¥æ£€æŸ¥hashcodeç›¸ç­‰çš„å¯¹è±¡æ˜¯å¦çœŸçš„ç›¸åŒã€‚å¦‚æœä¸¤è€…ç›¸åŒï¼ŒHashSetå°±ä¸ä¼šè®©åŠ å…¥æ“ä½œæˆåŠŸã€‚

**hashCodeï¼ˆï¼‰ä¸equalsï¼ˆï¼‰çš„ç›¸å…³è§„å®šï¼š**

1. å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™hashcodeä¸€å®šä¹Ÿæ˜¯ç›¸åŒçš„
2. ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰,å¯¹ä¸¤ä¸ªequalsæ–¹æ³•è¿”å›true
3. ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„hashcodeå€¼ï¼Œå®ƒä»¬ä¹Ÿä¸ä¸€å®šæ˜¯ç›¸ç­‰çš„
4. ç»¼ä¸Šï¼Œequalsæ–¹æ³•è¢«è¦†ç›–è¿‡ï¼Œåˆ™hashCodeæ–¹æ³•ä¹Ÿå¿…é¡»è¢«è¦†ç›–
5. hashCode()çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯¹å †ä¸Šçš„å¯¹è±¡äº§ç”Ÿç‹¬ç‰¹å€¼ã€‚å¦‚æœæ²¡æœ‰é‡å†™hashCode()ï¼Œåˆ™è¯¥classçš„ä¸¤ä¸ªå¯¹è±¡æ— è®ºå¦‚ä½•éƒ½ä¸ä¼šç›¸ç­‰ï¼ˆå³ä½¿è¿™ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘ç›¸åŒçš„æ•°æ®ï¼‰ã€‚

**==ä¸equalsçš„åŒºåˆ«**

1. ==æ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ˜¯ä¸æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ equalsæ˜¯åˆ¤æ–­ä¸¤ä¸ªå˜é‡æˆ–å®ä¾‹æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å€¼æ˜¯ä¸æ˜¯ç›¸åŒ
2. ==æ˜¯æŒ‡å¯¹å†…å­˜åœ°å€è¿›è¡Œæ¯”è¾ƒ equals()æ˜¯å¯¹å­—ç¬¦ä¸²çš„å†…å®¹è¿›è¡Œæ¯”è¾ƒ
3. ==æŒ‡å¼•ç”¨æ˜¯å¦ç›¸åŒ equals()æŒ‡çš„æ˜¯å€¼æ˜¯å¦ç›¸åŒ

## HashSet

æ•°æ®ç»“æ„å›¾

![img](https://img-blog.csdnimg.cn/img_convert/4f75a708eaac2f5857ebfad96796adc4.png)

### å¸¸è§é—®é¢˜ï¼ˆå› ä¸ºæ˜¯åŸºäºhashmap å®ç°çš„ï¼Œæ‰€ä»¥ä¸»è¦é—®é¢˜ä¹Ÿæ˜¯é—®hashmapæ¯”è¾ƒå¤šï¼‰

HashSetåº•å±‚ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå°±æ˜¯HshMapçš„valueéƒ½å˜æˆäº†ä¸€ä¸ªObjectå¯¹è±¡

## ConcurrentHashMap

æ•°æ®ç»“æ„å›¾

![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_jpg/uChmeeX1FpyhVLAW08sszrgEKUamuEKR92tLGjq5XU8SCBVmGAgiaSp95mnibgngXjFjycLTSkDMpOEfKvZaFBzQ/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**JDK1.8çš„ConcurrentHashMapï¼ˆTreeBin: çº¢é»‘äºŒå‰æ ‘èŠ‚ç‚¹ Node: é“¾è¡¨èŠ‚ç‚¹ï¼‰ï¼š**

![JDK1.8çš„ConcurrentHashMap](https://my-blog-to-use.oss-cn-beijing.aliyuncs.com/2019-6/JDK1.8-ConcurrentHashMap-Structure.jpg)

## ConcurrentHashSet

æ•°æ®ç»“æ„å›¾ï¼ˆåº•å±‚æ˜¯åŸºäºConcurrentHashMapå®ç°çš„ï¼Œæ‰€ä»¥é—®é¢˜ä¸»è¦å’ŒConcurrentHashMapæœ‰å…³ï¼‰

## LinkedHashMap

æ•°æ®ç»“æ„å›¾

![img](https://img-blog.csdnimg.cn/20190711160733331.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTI4NjA5Mzg=,size_16,color_FFFFFF,t_70)

![LinkedHashMapæºç è¯¦ç»†åˆ†æï¼ˆJDK1.8ï¼‰_](https://img.xiaoyou66.com/2021/04/09/fafad2940eb05.jpg)

### å¸¸è§é—®é¢˜ï¼ˆè¿™ä¸ªé—®çš„å¾ˆå°‘ï¼Œå› ä¸ºä¹Ÿä¸å¸¸ç”¨ï¼Œæˆ‘ä¸ªäººåœ¨ä¸€æ¬¡é¢è¯•ä¸­æœ‰è¢«é—®åˆ°ï¼Œæ‰€ä»¥è¿˜æ˜¯è®°å½•ä¸€ä¸‹ï¼‰

åº•å±‚

```java
//è¿™é‡Œå®ç°LRUå°±ä¸»è¦æ˜¯è¿™å‡ ä¸ªæ–¹æ³•ï¼Œ accessOrderå®šä¹‰æ˜¯å¦ä¼šæ’åºï¼Œå¦‚æœä¸ºtrueï¼Œé‚£ä¹ˆafterNodeAccessä¼šå°†è¯¥è¯¥èŠ‚ç‚¹ç½®äºæœ€åï¼Œget()æ–¹æ³•ä¹Ÿæ˜¯
public V getOrDefault(Object key, V defaultValue) {
       Node<K,V> e;
       if ((e = getNode(hash(key), key)) == null)
           return defaultValue;
       if (accessOrder)
           afterNodeAccess(e);
       return e.value;
   }

  public V get(Object key) {
        Node<K,V> e;
        if ((e = getNode(hash(key), key)) == null)
            return null;
        if (accessOrder)
            afterNodeAccess(e);
        return e.value;
    }
//è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®removeEldestEntryæ–¹æ³•è¿”å›å€¼è¿›è¡Œåˆ¤æ–­ï¼ˆéœ€è¦è¿›è¡Œé‡å†™ï¼‰ï¼Œå¦‚æœä¸ºfalseä¼šè‡ªåŠ¨å°†å¤´èŠ‚ç‚¹åˆ é™¤
 void afterNodeInsertion(boolean evict) { // possibly remove eldest
        LinkedHashMap.Entry<K,V> first;
        if (evict && (first = head) != null && removeEldestEntry(first)) {
            K key = first.key;
            removeNode(hash(key), key, null, false, true);
        }
    }
//å¦‚æœè¦å®ç°LRUï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œå®šä¹‰å®¹é‡ï¼Œå¦‚æœè¶…è¿‡å®¹é‡ï¼Œå°±ä¼šå°†æœ€å°‘ä½¿ç”¨çš„å¤´èŠ‚ç‚¹åˆ é™¤
   protected boolean removeEldestEntry(Map.Entry<K,V> eldest) {
        return false;
    }
```

1. LinkedHashMapå¯ä»¥å®ç°ä»€ä¹ˆï¼ŸLRU
2. åº•å±‚æ•°æ®ç»“æ„æ˜¯æ€æ ·çš„ï¼ŸåŒå‘é“¾è¡¨+çº¢é»‘æ ‘+æ•°ç»„
3. hashmapæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå®ƒæ˜¯æœ‰åºçš„



